{% extends 'layout.html.twig' %}

{% block title %}Stock | Référence | Article de référence{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    {{ encore_entry_link_tags('reference-article') }}
{% endblock %}

{% block page_content %}
    <div class="ra-container d-flex justify-content-center align-content-center">
        <div class="row ra-column">
            <div class="col-6">
                <div class="ra-header d-flex flex-column">
                    <div class="ra-type">{{ referenceArticle.type.label }}</div>
                    <div class="d-flex header-wrapper">
                        <div class="image-container">
                            <img src="{{ asset('svg/reference_article/product.svg') }}" alt="Image produit" width="70px">
                        </div>
                        <div class="specifications">
                            <div><strong>Ref : {{ referenceArticle.reference }}</strong></div>
                            <div><strong>{{ referenceArticle.libelle }}</strong></div>
                            <div class="d-flex align-content-center my-3">
                                <img src="{{ asset('svg/reference_article/stock.svg') }}" alt="Icône stock" class="mr-2" width="15px">
                                <span class="ra-field-text">Quantité disponible <strong>{{ referenceArticle.quantiteDisponible }}</strong></span>
                            </div>
                            <div class="d-flex align-content-center">
                            <span class="ra-small-text mr-3">
                                Référence {{ referenceArticle.statut == constant('App\\Entity\\ReferenceArticle::STATUT_ACTIF') ? 'active' : 'inactive' }}
                            </span>
                                <div class="d-flex align-content-center">
                                    <img
                                        src="{{ asset('svg/reference_article/' ~ (referenceArticle.needsMobileSync ? 'mobile-sync-on.svg' : 'mobile-sync-off.svg')) }}"
                                        alt="Icône synchronisation nomade" width="10px"><span class="ra-small-text ml-2">Synchronisation nomade<sup>
                                        <img src="{{ asset('svg/reference_article/information.svg') }}" alt="Icône information" width="10px"
                                             class="has-tooltip" title="A définir"></sup>
                                </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="ra-box mt-3">
                    <div class="header ra-title">Informations</div>
                    <div class="content">
                        <div class="d-flex">
                            <div class="col-6 d-flex">
                                <img src="{{ asset('svg/reference_article/manager.svg') }}" alt="Icône utilisateur" width="20px">
                                <div class="box-item ml-3">
                                    <span class="ra-field-name">Gestionnaires</span>
                                    <span>{{ referenceArticle.managers | map(m => m.username) | join(', ') }}</span>
                                </div>
                            </div>
                            <div class="col-6 d-flex">
                                <img src="{{ asset('svg/reference_article/manager.svg') }}" alt="Icône utilisateur" width="20px">
                                <div class="box-item ml-3">
                                    <span class="ra-field-name">Acheteur</span>
                                    <span>{{ referenceArticle.buyer ? referenceArticle.buyer.username }}</span>
                                </div>
                            </div>
                        </div>

                        <div class="d-flex mt-4">
                            <div class="col-6 d-flex">
                                <img src="{{ asset('svg/reference_article/warehouse.svg') }}" alt="Icône utilisateur" width="20px">
                                <div class="box-item ml-3">
                                    <span class="ra-field-name">Catégorie d'inventaire</span>
                                    <span>{{ referenceArticle.category ? referenceArticle.category.label : '-' }}</span>
                                </div>
                            </div>
                            <div class="col-6 d-flex">
                                <img src="{{ asset('svg/reference_article/calendar.svg') }}" alt="Icône utilisateur" width="20px">
                                <div class="box-item ml-3">
                                    <span class="ra-field-name">Date de dernier inventaire</span>
                                    <span>{{ lastInventoryDate }}</span>
                                </div>
                            </div>
                        </div>

                        <div class="d-flex mt-4 ml-3">
                            <span class="ra-field-name mr-2">Groupe de visibilité</span> <span
                                class="ra-body-text"> Groupe 1</span>{# TODO ajouter le groupe de visibilité #}
                        </div>

                        <div class="my-4 ml-3">
                            <span class="ra-subtitle">Pièces jointe</span>
                            {% set url = app.request is not null ? app.request.getSchemeAndHttpHost() : app_url %}
                            {% for attachment in referenceArticle.attachments %}
                                <div class="attachment-item mt-2">
                                    <img src="{{ asset('svg/reference_article/file.svg') }}" alt="Icône fichier" width="13px" class="mr-2">
                                    <a target="_blank" class="ra-small-text"
                                       href="{{ url ~ '/uploads/attachements/' ~ attachment.fileName }}"
                                       download="{{ attachment.originalName }}">
                                        {{ attachment.originalName }}
                                    </a>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                    <div class="content comment-container">
                        <div class="ml-3">
                            <span class="ra-subtitle">Commentaire</span>
                            <div
                                class="mt-2">{{ referenceArticle.commentaire and referenceArticle.commentaire != '<p><br></p>' ? referenceArticle.commentaire | raw : '-' }}</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-6">
                <div class="ra-box">
                    <div class="header ra-title">Gestion quantité</div>
                    <div class="content">
                        <div class="d-flex">
                            <div class="col-6 d-flex">
                                <img src="{{ asset('svg/reference_article/pack.svg') }}" alt="Icône colis" width="20px">
                                <span class="ra-field-name ml-3">
                                    Quantité gérée à {{ referenceArticle.typeQuantite == constant('App\\Entity\\ReferenceArticle::TYPE_QUANTITE_REFERENCE') ? 'la référence' : 'l\'article' }}
                                </span>
                            </div>
                        </div>

                        <div class="d-flex mt-4">
                            <div class="col-4 d-flex">
                                <img src="{{ asset('svg/reference_article/location.svg') }}" alt="Icône emplacement" width="20px">
                                <div class="box-item ml-3">
                                    <span class="ra-field-name">Emplacement</span>
                                    <span>{{ referenceArticle.emplacement ? referenceArticle.emplacement.label : '-' }}</span>
                                </div>
                            </div>
                            <div class="col-8 d-flex">
                                <img src="{{ asset('svg/reference_article/stock.svg') }}" alt="Icône stock" width="20px">
                                <div class="box-item ml-3">
                                    <span class="ra-field-name">Quantité en stock</span>
                                    <span>{{ referenceArticle.quantiteStock }}</span>
                                </div>
                            </div>
                        </div>

                        <div class="d-flex mt-4">
                            <div class="col-4 d-flex">
                                <img src="{{ asset('svg/reference_article/price.svg') }}" alt="Icône prix" width="15px">
                                <div class="box-item ml-3">
                                    <span class="ra-field-name">Prix unitaire (€)</span>
                                    <span>{{ referenceArticle.prixUnitaire ?? '-' }}</span>
                                </div>
                            </div>
                            <div class="col-4 d-flex">
                                <img src="{{ asset('svg/reference_article/alert-threshold.svg') }}" alt="Icône seuil d'alerte" width="20px">
                                <div class="box-item ml-3">
                                    <span class="ra-field-name">Seuil d'alerte</span>
                                    <span>{{ referenceArticle.limitWarning ?? '-' }}</span>
                                </div>
                            </div>
                            <div class="col-4 d-flex">
                                <img src="{{ asset('svg/reference_article/security-threshold.svg') }}" alt="Icône seuil de sécurité" width="20px">
                                <div class="box-item ml-3">
                                    <span class="ra-field-name">Seuil de sécurité</span>
                                    <span>{{ referenceArticle.limitSecurity ?? '-' }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="ra-dropdown mt-3">
                        <label for="touch">
                            <span class="ra-subtitle dropdown-wrapper">Fournisseurs</span>
                        </label>
                        <input type="checkbox" id="touch">

                        <ul class="slide">
                            {% for providerArticle in referenceArticle.articlesFournisseur %}
                                <li class="mb-3">
                                    <div class="provider-label">
                                        <span class="ra-field-name ml-3">{{ providerArticle.fournisseur.nom }}</span>&nbsp;- {{ providerArticle.fournisseur.codeReference }}
                                    </div>
                                    <div class="d-flex mt-3">
                                        <div class="col-4 d-flex flex-column">
                                            <span class="ra-field-name">Ref article fournisseur</span>
                                            <span>{{ providerArticle.reference ?? '-' }}</span>
                                        </div>
                                        <div class="col-4 d-flex flex-column">
                                            <span class="ra-field-name">Label</span>
                                            <span>{{ providerArticle.label ?? '-' }}</span>
                                        </div>
                                        <div class="col-4 d-flex flex-column">
                                            <span class="ra-field-name">Quantité en stock</span>
                                            <span>{{ providerArticle.referenceArticle.quantiteStock }}</span>
                                        </div>
                                    </div>
                                </li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>

                <div class="ra-box mt-3">
                    <div class="header ra-title">Champs libres</div>
                    <div class="content d-flex flex-wrap">
                        {% for freeField in freeFields %}
                            {% set value = freeFieldValues[freeField.id]
                                ?? (freeField.defaultValue
                                ?? '') %}

                            {% if freeField.typage == constant('App\\Entity\\FreeField::TYPE_DATE') %}
                                <div class="col-6 box-item mb-3">
                                    <span class="ra-field-name">{{ freeField.label }}</span>
                                    <span>{{ value | date('d/m/Y') }}</span>
                                </div>
                            {% elseif freeField.typage == constant('App\\Entity\\FreeField::TYPE_DATETIME') %}
                                <div class="col-6 box-item mb-3">
                                    <span class="ra-field-name">{{ freeField.label }}</span>
                                    <span>{{ value | replace({'/': '-'}) | date('d/m/Y H:i') }}</span>
                                </div>
                            {% elseif freeField.typage == constant('App\\Entity\\FreeField::TYPE_BOOL') %}
                                <div class="col-6 box-item mb-3">
                                    <span class="ra-field-name">{{ freeField.label }}</span>
                                    <span>{{ value == 1 ? 'Oui' : 'Non' }}</span>
                                </div>
                            {% endif %}
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    {{ encore_entry_script_tags('reference-article') }}
    <script src="{{ asset('js/pages/referenceArticle.js') }}?v={{ web_version }}"></script>
{% endblock %}
