{% import 'form.html.twig' as form %}

{% set displayAction = 'displayedCreate' %}
{% set requiredAction = 'requiredCreate' %}

<div class="row fly-form">
    {% set carrierFieldCode = constant('App\\Entity\\FieldsParam::FIELD_CODE_TRUCK_ARRIVAL_CARRIER') %}
    {% set displayOnform = fieldsParam|isFieldRequired(carrierFieldCode, displayAction) %}
    {% if displayOnform %}
        {% set requiredOnform = fieldsParam|isFieldRequired(carrierFieldCode, requiredAction) %}
        <div class="form-group col w-100">
            {{ form.select('carrier', 'Transporteur', requiredOnform, {
                type: 'carrier',
            }) }}
        </div>
        {% if hasRight(constant('App\\Entity\\Menu::REFERENTIEL'), constant('App\\Entity\\Action::CREATE')) %}
            <div class="form-group col-auto toggle-button-container">
                <span class="btn btn-primary d-flex align-items-center p-2"
                      onclick="onFlyFormToggle('transporteurDisplay', 'addTransporteur')">
                    <span class="wii-icon wii-icon-plus mr-2"></span>
                    Créer
                </span>
            </div>
        {% endif %}
    {% endif %}
    {% set driverFieldCode = constant('App\\Entity\\FieldsParam::FIELD_CODE_TRUCK_ARRIVAL_DRIVER') %}
    {% set displayOnform = fieldsParam|isFieldRequired(driverFieldCode, displayAction) %}
    {% if displayOnform %}
        {% set requiredOnform = fieldsParam|isFieldRequired(driverFieldCode, requiredAction) %}
        <div class="form-group col w-100">
            {{ form.select('driver', 'Chauffeur', requiredOnform, {
                type: 'driver',
            }) }}
        </div>
        {% if hasRight(constant('App\\Entity\\Menu::REFERENTIEL'), constant('App\\Entity\\Action::CREATE')) %}
            <div class="form-group col-auto toggle-button-container">
                <span class="btn btn-primary d-flex align-items-center p-2"
                      onclick="onFlyFormToggle('chauffeurDisplay', 'addChauffeur')">
                    <span class="wii-icon wii-icon-plus mr-2"></span>
                    Créer
                </span>
            </div>
        {% endif %}
    {% endif %}
</div>

{% if hasRight(constant('App\\Entity\\Menu::REFERENTIEL'), constant('App\\Entity\\Action::CREATE')) %}
    <div class="row align-items-start">
        {% if fieldsParam|isFieldRequired(carrierFieldCode, 'displayedCreate') %}
            <div class="col fly-form" style="height: 0">
                <div class="row">
                    <div class="form-group col invisible" id="transporteurDisplay">
                        {{ form.input('label', 'Nom*', false, null, {
                            inputClass: 'neededNew newFormulaire',
                        }) }}
                        {{ form.input('code', 'Code*', false, null, {
                            inputClass: 'neededNew newFormulaire',
                        }) }}
                    </div>
                    <div class="form-group col-auto invisible submit-button-container" id="addTransporteur">
                        <span class="btn btn-primary"
                              onclick="onFlyFormSubmit(Routing.generate('transporteur_new', true), $(this), 'transporteurDisplay', 'addTransporteur', $('[name=transporteur]'))">
                            <i class="fas fa-check-circle"></i>
                        </span>
                    </div>
                </div>
            </div>
        {% endif %}
        {% if fieldsParam|isFieldRequired(driverFieldCode, 'displayedCreate') %}
            <div class="col fly-form" style="height: 0">
                <div class="row">
                    <div class="form-group col-10 invisible" id="chauffeurDisplay">
                        {{ form.input('nom', 'Nom*', false, null, {
                            inputClass: 'neededNew newFormulaire',
                        }) }}
                        {{ form.input('prenom', 'Prénom*', false, null, {
                            inputClass: 'neededNew newFormulaire',
                        }) }}
                        {{ form.input('documentID', 'DocumentID*', false, null, {
                            inputClass: 'neededNew newFormulaire',
                        }) }}
                    </div>
                    <div class="form-group col-2 invisible submit-button-container" id="addChauffeur">
                        <span class="btn btn-primary"
                              onclick="onFlyFormSubmit(Routing.generate('chauffeur_new', true), $(this), 'chauffeurDisplay', 'addChauffeur', $('[name=chauffeur]'))">
                            <i class="fas fa-check-circle"></i>
                        </span>
                    </div>
                </div>
            </div>
        {% endif %}
    </div>
{% endif %}

<div class="row">
    {% set fieldCode = constant('App\\Entity\\FieldsParam::FIELD_CODE_TRUCK_ARRIVAL_REGISTRATION_NUMBER') %}
    {% set displayOnform = fieldsParam|isFieldRequired(fieldCode, displayAction) %}
    {% if displayOnform %}
        {% set requiredOnform = fieldsParam|isFieldRequired(fieldCode, requiredAction) %}
        <div class="col-6">
            {{ form.input('registrationNumber', 'Immatirculation', requiredOnform, null) }}
        </div>
    {% endif %}

    {% set fieldCode = constant('App\\Entity\\FieldsParam::FIELD_CODE_TRUCK_ARRIVAL_UNLOADING_LOCATION') %}
    {% set displayOnform = fieldsParam|isFieldRequired(fieldCode, displayAction) %}
    {% if displayOnform %}
        {% set requiredOnform = fieldsParam|isFieldRequired(fieldCode, requiredAction) %}
        <div class="col-6">
            {{ form.select('unloadingLocation', 'Emplacement de déchargement', requiredOnform, {
                type: 'location',
            }) }}
        </div>
    {% endif %}
</div>
<div class="wii-section-title my-3 d-flex align-items-center justify-content-between">
    <span>
        Numéros de tracking transporteur
    </span>
    <span>
        Total : <span id="totalTrackingNumber">0</span>
    </span>

</div>
<div class="w-100">
    <table class="w-100 table-truck-article-line"></table>
</div>
<div class="wii-section-title my-3 d-flex align-items-center">
    Réserve sur l’arrivage camion
</div>
<div class="row mb-4">
    <div class="col-4">
        {{ form.checkbox('hasGeneralReserve', 'Réserve général', false, null, {
            inputClass: 'display-condition',
        }) }}
    </div>
    <div class="col-8 displayed-on-checkbox">
        {{ form.input('generalReserveComment', 'Commentaire', false, null, ) }}
    </div>
</div>
<div class="row">
    <div class="col-4">
        {{ form.checkbox('hasQuantityReserve', 'Réserve quantité +/-', false, null, {
            inputClass: 'display-condition',
        }) }}
    </div>
    <div class="col-8 displayed-on-checkbox">
        <div class="d-flex">
            {{ form.input('reserveQuantity', 'Valeur', false, null, {
                type: 'number',
                min: 0,
            }) }}
            <div class="mx-2 mt-auto">
                {{ form.switch('reserveType', '', false, constant('App\\Entity\\Reserve::QUANTITY_TYPES')|map((type) => {
                    label: type,
                    value: type,
                    checked: false,
                } )) }}
            </div>
            {{ form.input('quantityReserveComment', 'Commentaire', false, null) }}
        </div>
    </div>
</div>

<input type="hidden" id="truck-arrival-line-form" value="{{ {
    'actions' : '<i class="wii-icon wii-icon-trash delete-row "></i>',
    'trackingLinesNumber': form.input('trackingLinesNumber', '', false, null),
    'hasQualityReserve': form.checkbox('hasQualityReseve', '', false, null, {
        inputClass: 'display-condition',
    }),
    'attachment': include('attachment/attachment.html.twig', { isNew: true , buttonOnly: true, noLabel: true, disabled: true}),
    'comment': form.input('comment', '', false, null, {disabled: true}),
} | json_encode }}">
