{% extends 'layout.html.twig' %}

{% block title %}<a href="{{ path('settings_index') }}">Param√©trage</a> | <span id="page-title" class="text-regular">Chargement</span>{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    {{ encore_entry_link_tags('settings') }}
{% endblock %}

{% set can_edit = hasRight(constant('App\\Entity\\Menu::PARAM'), constant('App\\Entity\\Action::EDIT')) %}

{% block page_content %}
    <div class="settings">
        <aside class="wii-box">
            {% for key, label in parent.menus %}
                {% if label is iterable %}
                    <a href="{{ path(label.route is defined ? label.route : 'settings_item', label.route is not defined ? {category, menu: key} : []) }}" class="settings-item">
                        {{ label.label }}
                    </a>
                {% else %}
                    <div class="settings-item {{ key == selected ? 'selected' }}" data-menu="{{ key }}">
                        {{ label }}
                    </div>
                {% endif %}
            {% endfor %}
        </aside>

        <main>
            {% for key, label in parent.menus %}
                {% if label is not iterable %}
                    {% set fetcher = submenu ? (values[category][menu][key] ?? []) : (values[category][key] ?? []) %}

                    {% if path ~ key not in ['settings/donnees/imports', 'settings/stock/articles/types_champs_libres'] %}
                        <div class="wii-box {{ key != selected ? 'd-none' }}"
                             data-path="{{ category }}_{{ submenu ? menu : key }}{{ submenu ? '_' ~ key : '' }}"
                             data-menu="{{ key }}">
                            <div class="header wii-title">{{ label }}</div>
                            <div class="content focus-shadow">
                                {% dump values %}
                                {% include [path ~ key ~ '.html.twig', 'settings/todo.html.twig'] with {
                                    page: path ~ key ~ '.html.twig'
                                } | merge(fetcher ? call(fetcher) : []) %}
                            </div>
                        </div>
                    {% else %}
                        <div class="{{ key != selected ? 'd-none' }}"
                             data-path="{{ category }}_{{ submenu ? menu : key }}{{ submenu ? '_' ~ key : '' }}"
                             data-menu="{{ key }}">
                            {% include [path ~ key ~ '.html.twig', 'settings/todo.html.twig'] with {
                                page: path ~ key ~ '.html.twig'
                            } | merge(fetcher ? call(fetcher) : []) %}
                        </div>
                    {% endif %}
                {% endif %}
            {% endfor %}

            {% if can_edit %}
                <div class="save">
                    <button class="btn btn-success save-settings">Enregistrer</button>
                </div>
            {% endif %}
        </main>
    </div>

    <input type="hidden" id="settings" value="{{ constant('App\\Controller\\SettingsController::SETTINGS') | json_encode }}">
    <input type="hidden" id="category" value="{{ category }}">
    <input type="hidden" id="menu" value="{{ menu }}">
    <input type="hidden" id="submenu" value="{{ submenu }}">
    <input type="hidden" id="edit" value="{{ can_edit }}">
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    {{ encore_entry_script_tags('settings') }}
{% endblock %}
