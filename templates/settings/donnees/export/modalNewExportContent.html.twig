{% import 'form.html.twig' as form %}

<div>
    {{ form.radio('exportTypeContainer', null, false, [
        {label: 'Export CSV unique', value: 'exportUnique', checked: true},
        {label: 'Export CSV planifié', value: 'exportScheduled'}
    ], {
        containerClass: 'export-type-container'
    }) }}
    <div>
        <div class="wii-section-title my-3">Type de données à exporter</div>

        {{ form.switch('entityToExport', null, true, [
            {label: 'Références', value: 'reference', class: 'export-references', checked: true},
            {label: 'Articles', value: 'article', class: 'export-articles' },
            {label: 'Tournées', value: 'tournee', class: 'export-transport-rounds' },
            {label: 'Arrivages', value: 'arrivage', class: 'export-arrivals'}
        ], {expanded: true}) }}

        <div class="unique-export-container my-3">
            <label class="ref-articles-sentence wii-small-text">Les articles exportés sont seulement ceux avec le groupe de visibilité rattaché à l'utilisateur.</label>
            <div class="date-limit d-none">
                <label class="wii-field-name">Bornes de dates</label>
                <div class="col-12 col-md-6 p-0">
                    <div class="h-100">
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <span class="input-group-text w-50px d-flex justify-content-center">Du</span>
                            </div>
                            <input type="text"
                                   class="form-control cursor-default filter-date-min data"
                                   name="dateMin"
                                   placeholder="jj/mm/aaaa"
                                   autocomplete="off"/>
                            <div class="input-group-prepend input-group-append">
                                <span class="input-group-text w-50px d-flex justify-content-center">Au</span>
                            </div>
                            <input type="text"
                                   class="form-control cursor-default filter-date-max data"
                                   name="dateMax"
                                   placeholder="jj/mm/aaaa"
                                   autocomplete="off"/>
                        </div>
                    </div>
                </div>
            </div>
            <div class="column-to-export d-none">
                {{ form.select('columnToExport', 'Colonnes à exporter', false, {
                    items: arrivalFields,
                    multiple: true,
                }) }}
            </div>
        </div>
        <div class="scheduled-export-container my-3 d-none">
            <div class="period-interval mb-3 d-none">
                <label class="wii-field-name">Période de données</label>
                <div class="d-flex align-items-center mt-2">
                    <label class="mr-3">Sur</label>
                    {{ form.select('periodInterval', null, false, {
                        items: [
                            {label: 'le jour', value: constant('App\\Entity\\Export::PERIOD_INTERVAL_DAY')},
                            {label: 'la semaine', value: constant('App\\Entity\\Export::PERIOD_INTERVAL_WEEK')},
                            {label: 'le mois', value: constant('App\\Entity\\Export::PERIOD_INTERVAL_MONTH')},
                            {label: "l'année", value: constant('App\\Entity\\Export::PERIOD_INTERVAL_YEAR')}
                        ],
                        inputClass: 'data period-select',
                        labelClass: 'mr-3 w-100'
                    }) }}

                    {{ form.select('period', null, false, {
                        items: [
                            {label: 'en cours (jour J)', value: constant('App\\Entity\\Export::PERIOD_CURRENT')},
                            {label: 'dernier (jour J-1)', value: constant('App\\Entity\\Export::PERIOD_PREVIOUS')},
                        ],
                        inputClass: 'data period-interval-select',
                    }) }}
                </div>
            </div>
            <div class="column-to-export d-none">
                {{ form.select('columnToExport', 'Colonnes à exporter', false, {
                    items: arrivalFields,
                    multiple: true,
                }) }}
            </div>
            <div>
                <div class="wii-section-title my-3">Fréquence</div>
                <div class="row frequencies mt-3">
                    {{ form.radio('frequency', null, false, [
                        {label: 'Une fois', value: constant('App\\Entity\\ExportScheduleRule::ONCE'), id: 'input-radio-frequency-once-frequency', checked: true},
                        {label: 'Chaque heure', value: constant('App\\Entity\\ExportScheduleRule::HOURLY'), id: 'input-radio-frequency-hourly-frequency'},
                        {label: 'Chaque jour', value: constant('App\\Entity\\ExportScheduleRule::DAILY'), id: 'input-radio-frequency-every-day-frequency'},
                        {label: 'Chaque semaine', value: constant('App\\Entity\\ExportScheduleRule::WEEKLY'), id: 'input-radio-frequency-every-week-frequency'},
                        {label: 'Chaque mois', value: constant('App\\Entity\\ExportScheduleRule::MONTHLY'), id: 'input-radio-frequency-every-month-frequency'}
                    ], {
                        containerClass: 'col-4 frequencies-container',
                        onChange: 'toggleFrequencyInput($(this))'
                    }) }}
                    <div class="col-8 frequency-content d-none">
                        {% include 'settings/donnees/export/frequencies/once.html.twig' %}
                        {% include 'settings/donnees/export/frequencies/hourly.html.twig' %}
                        {% include 'settings/donnees/export/frequencies/daily.html.twig' %}
                        {% include 'settings/donnees/export/frequencies/weekly.html.twig' %}
                        {% include 'settings/donnees/export/frequencies/monthly.html.twig' %}
                    </div>
                </div>
            </div>
            <div>
                <div class="wii-section-title my-3">Destination d'export</div>
                {{ form.radio('destinationType', null, false, [
                    {label: 'Envoi email', value: constant('App\\Entity\\Export::DESTINATION_EMAIL'), class: 'export-by-email', checked: true },
                    {label: 'Envoi vers serveur SFTP', value: constant('App\\Entity\\Export::DESTINATION_SFTP'), class: 'export-by-sftp'}
                ], {
                    onChange: 'destinationExportChange()'
                }) }}
                <div class="export-email-destination my-3">
                    {{ form.select('recipientUsers', 'Utilisateur(s) Follow GT', false, {
                        type: 'user',
                        multiple: true,
                    }) }}

                    {{ form.select('recipientEmails', 'Email(s) libre(s)', false, {
                        type: null,
                        multiple: true,
                        editable: true,
                        labelClass: 'mt-2 w-100'
                    }) }}
                </div>
                <div class="export-sftp-destination d-none">
                    <label class="wii-section-title my-3">Paramétrer le serveur</label>
                    {{ form.input('host', 'Serveur Hôte', false, null, {
                        type: 'text',
                        labelClass: 'col-5 my-2'
                    }) }}
                    {{ form.input('port', 'Port', false, null, {
                        type: 'text',
                        labelClass: 'col-5 pr-0 my-2'
                    }) }}
                    {{ form.input('user', 'Utilisateur', false, null, {
                        type: 'text',
                        labelClass: 'col-5 my-2'
                    }) }}
                    {{ form.input('password', 'Mot de passe', false, null, {
                        type: 'text',
                        labelClass: 'col-5 pr-0 my-2'
                    }) }}
                    {{ form.input('targetDirectory', "Répertoire cible de l'export", false, null, {
                        type: 'text',
                        labelClass: 'col-5 my-2'
                    }) }}
                </div>
            </div>
        </div>
    </div>
</div>
